C51 COMPILER V9.60.7.0   ADC                                                               11/01/2025 22:20:39 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN .\Objects\adc.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE adc.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\adc.l
                    -st) TABS(2) OBJECT(.\Objects\adc.obj)

line level    source

   1          #include<reg51.h>
   2          
   3          sbit ADC_RD = P2^5;
   4          sbit ADC_WR = P2^6;
   5          sbit ADC_INTR = P2^7;
   6          sbit LCD_RS = P2^2;
   7          sbit LCD_EN = P2^1;
   8          
   9          // Add delay function
  10          void delay_ms(unsigned int ms)
  11          {
  12   1          unsigned int i, j;
  13   1          for(i=0; i<ms; i++)
  14   1              for(j=0; j<1275; j++);
  15   1      }
  16          
  17          void lcd_cmd(unsigned char cmd)
  18          {
  19   1          P3 = cmd;
  20   1          LCD_RS = 0;
  21   1          LCD_EN = 1;
  22   1          delay_ms(2);    // Added delay
  23   1          LCD_EN = 0;
  24   1          delay_ms(2);    // Added delay
  25   1      }
  26          
  27          void lcd_data(unsigned char dat)
  28          {
  29   1          P3 = dat;
  30   1          LCD_RS = 1;
  31   1          LCD_EN = 1;
  32   1          delay_ms(2);    // Added delay
  33   1          LCD_EN = 0;
  34   1          delay_ms(2);    // Added delay
  35   1      }
  36          
  37          void lcd_string(char *s)
  38          {
  39   1          while(*s) lcd_data(*s++);
  40   1      }
  41          
  42          void lcd_init()
  43          {
  44   1          delay_ms(20);   // LCD power-up delay
  45   1          lcd_cmd(0x38);
  46   1          lcd_cmd(0x0C);
  47   1          lcd_cmd(0x01);
  48   1          lcd_cmd(0x06);
  49   1      }
  50          
  51          unsigned char read_adc()
  52          {
  53   1          unsigned char value;
  54   1          
C51 COMPILER V9.60.7.0   ADC                                                               11/01/2025 22:20:39 PAGE 2   

  55   1          // Start conversion sequence
  56   1          ADC_WR = 0;
  57   1          delay_ms(1);    // Wait for setup
  58   1          ADC_WR = 1;     // Rising edge starts conversion
  59   1          delay_ms(1);
  60   1          
  61   1          // Wait for conversion to complete (INTR goes LOW)
  62   1          while(ADC_INTR == 1);  // FIXED: Wait while INTR is HIGH
  63   1          
  64   1          // Read data
  65   1          ADC_RD = 0;
  66   1          delay_ms(1);
  67   1          value = P1;     // Read ADC value
  68   1          ADC_RD = 1;
  69   1          
  70   1          return value;
  71   1      }
  72          
  73          void main()
  74          {
  75   1          unsigned char adc_val;
  76   1          
  77   1          // Initialize ports
  78   1          P1 = 0xFF;      // Make Port 1 input for ADC
  79   1          
  80   1          lcd_init();
  81   1          lcd_cmd(0x80);
  82   1          lcd_string("ADC Value:");
  83   1          
  84   1          while(1)
  85   1          {
  86   2              adc_val = read_adc();
  87   2              
  88   2              lcd_cmd(0xC0);        // Second line
  89   2              
  90   2              // Display digital value
  91   2              lcd_data('D');
  92   2              lcd_data(':');
  93   2              lcd_data(adc_val/100 + '0');
  94   2              lcd_data((adc_val/10)%10 + '0');
  95   2              lcd_data(adc_val%10 + '0');
  96   2              lcd_data(' ');
  97   2              lcd_data(' ');
  98   2              lcd_data(' ');
  99   2              lcd_data(' ');
 100   2              
 101   2              delay_ms(200);  // Refresh rate
 102   2          }
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    258    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

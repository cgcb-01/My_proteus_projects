C51 COMPILER V9.60.7.0   DAC                                                               09/11/2025 10:31:41 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DAC
OBJECT MODULE PLACED IN .\Objects\DAC.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE DAC.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\DAC.l
                    -st) TABS(2) OBJECT(.\Objects\DAC.obj)

line level    source

   1          #include <reg51.h>
   2          
   3          typedef unsigned char  u8;
   4          typedef unsigned int   u16;
   5          
   6          /* LCD pins (change if you wired differently) */
   7          sbit LCD_RS = P2 ^ 0;
   8          sbit LCD_EN = P2 ^ 2;
   9          
  10          /* small software delay - portable */
  11          void delay_ms(u16 ms)
  12          {
  13   1          volatile u16 i, j;
  14   1          for (i = 0; i < ms; i++) {
  15   2              for (j = 0; j < 120; j++) { /* tune this constant for your crystal */
  16   3                  volatile u8 x = 0;
  17   3                  x++;
  18   3              }
  19   2          }
  20   1      }
  21          
  22          /* tiny delay used for enable pulse */
  23          void tiny_delay(void)
  24          {
  25   1          volatile u16 k;
  26   1          for (k = 0; k < 200; k++); /* small loop */
  27   1      }
  28          
  29          void lcd_pulse(void)
  30          {
  31   1          LCD_EN = 1;
  32   1          tiny_delay();
  33   1          LCD_EN = 0;
  34   1          delay_ms(1);
  35   1      }
  36          
  37          void lcd_cmd(u8 c)
  38          {
  39   1          LCD_RS = 0;
  40   1          P3 = c;
  41   1          lcd_pulse();
  42   1          delay_ms(2);
  43   1      }
  44          
  45          void lcd_data(u8 d)
  46          {
  47   1          LCD_RS = 1;
  48   1          P3 = d;
  49   1          lcd_pulse();
  50   1          delay_ms(1);
  51   1      }
  52          
  53          void lcd_init(void)
  54          {
C51 COMPILER V9.60.7.0   DAC                                                               09/11/2025 10:31:41 PAGE 2   

  55   1          delay_ms(20);
  56   1          lcd_cmd(0x38); /* 8-bit, 2-line */
  57   1          lcd_cmd(0x0C); /* display on, cursor off */
  58   1          lcd_cmd(0x06); /* entry mode */
  59   1          lcd_cmd(0x01); /* clear */
  60   1          delay_ms(2);
  61   1      }
  62          
  63          /* print value 0..255 on LCD (no printf) */
  64          void lcd_print_dec(u16 v)
  65          {
  66   1          char buf[4];
  67   1          u8 idx = 0;
  68   1      
  69   1          if (v > 255) v = 255;
  70   1          buf[0] = '0' + (v / 100);
  71   1          buf[1] = '0' + ((v / 10) % 10);
  72   1          buf[2] = '0' + (v % 10);
  73   1          buf[3] = 0;
  74   1      
  75   1          /* skip leading zeros but print at least one digit */
  76   1          if (buf[0] == '0') {
  77   2              if (buf[1] == '0') idx = 2;
  78   2              else idx = 1;
  79   2          } else idx = 0;
  80   1      
  81   1          while (buf[idx]) lcd_data(buf[idx++]);
  82   1      }
  83          
  84          void main(void)
  85          {
  86   1          u16 v;
  87   1          /* make control pins known */
  88   1          LCD_RS = 0;
  89   1          LCD_EN = 0;
  90   1          P1 = 0x00; /* start DAC at 0 */
  91   1          P3 = 0x00;
  92   1      
  93   1          lcd_init();
  94   1      
  95   1          while (1) {
  96   2              for (v = 0; v < 256; v++) {
  97   3                  P1 = (u8)v;            /* output to DAC */
  98   3                  lcd_cmd(0x80);        /* first line pos 0 */
  99   3                  lcd_print_dec(v);
 100   3                  delay_ms(30);         /* ~30 ms per step - change if needed */
 101   3              }
 102   2          }
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    323    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
